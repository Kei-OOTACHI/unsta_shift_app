# シフト自動化システム 利用マニュアル

## 目的

このシステムは、シフト表作成作業を効率化し、人的ミスを削減するためのツールです。以下の業務を自動化できます：

- **シフト表テンプレートの作成**: 時間軸の自動生成と行の一括複製により、効率的なシフト表のベースを作成
- **部署別シフト表の自動生成**: 「2~3.メンバー情報」シートのデータを元に、部署ごとのシフト表を自動作成
- **メンバー情報の一括更新**: 「2~3.メンバー情報」シートのデータの変更を全シフト表に一度に反映
- **シフトデータの登録・統合**: 「4.登録予定_入力データ」に入力されたシフト情報をシフト表に自動反映

## 禁止事項

### ⚠️ 絶対にやってはいけないこと

1. **原本のGASスクリプトの直接編集**
   - バックアップを取っていないため、スクリプトが復元不可能になる可能性があります
   - スクリプトを改良したい場合は、必ずコピーを作成してからコンテナバインドスクリプトを編集してください

2. **名前付き範囲の削除・名前変更**
   - システムが正常に動作しなくなります
   - 「データ」→「名前付き範囲」で表示される名前付き範囲は削除しないでください
   - ただし、範囲の変更は可能です。見出し行の列数や位置を変更した場合は、必ず範囲も修正してください

3. **システム用シートの削除・名前変更**
   - 以下6つのシートは削除・名前変更禁止：
     - 「1~2.シフト表テンプレ」「2~3.メンバー情報」「4.登録予定_入力データ」
     - 「4.登録済み_出力データ」「4.登録失敗_重複データ」「4.登録失敗_エラーデータ」
   - また、シフト表SSで作成されたシート名の変更も禁止（メンバー情報のdept列と一致している必要があるため）

4. **見出し行のルール違反**
   - **「2~3.メンバー情報」**: 1行目に見出し行が必須。dept・emailは必須項目です
   - **「4.登録予定_入力データ」**: 見出し行の並び替えのみ可能、追加削除・名前変更は禁止
   - **「1~2.シフト表テンプレ」**: 見出し行の追加削除・名前変更・位置変更は自由。ただしmemberId・date・memberDateIdは必須

**上記の変更が必要な場合**: GASのグローバル定数修正が必要なため、技術者に依頼してください

### ⚠️ 注意すべきこと

- 処理中はシートの編集（値の追加削除、書式の変更、列の追加削除など）を行わないでください
- エラーが発生した場合は、エラーメッセージのスクリーンショットを保存してください。エラーが継続する場合はエンジニアに相談してください

## 用語定義

### システム内で使用される主要な用語

- **メンバー情報**: 「2~3.メンバー情報」シートに記録されているスタッフの基本情報（部署、メールアドレス、特性等）
- **シフト表（シフト表SS）**: 各部署のスタッフのシフトのガントチャートシートをまとめたファイル
- **部署（dept）**: メンバーの所属局。シフト表ではこの単位でシートが作成される
- **見出し行（ヘッダー行）**: 各シートの1行目にある、各列の役割を示す行
- **名前付き範囲**: システムが特定のセル範囲を認識するために設定された範囲名
- **memberDateId**: メンバーIDと日付を組み合わせたユニークな識別子
- **background（背景色）**: シフト表のセルに表示される背景色

## トラブルシューティング

### よくあるトラブルと対処法

#### 1. 実行途中で動作が止まった
- **「4.シフトデータの登録」の最中で止まった場合**: 
  1. スプレッドシートの履歴機能（ファイル → 版の履歴）でシフト表を実行前の状態に復元
  2. 復元後に「手順4. シフトデータの登録」を最初からやり直してください
- **その他の機能の実行途中で止まった場合**: 
  履歴復元なしで該当の手順を最初からやり直してください

#### 2. ヘッダー行を追加削除した後の確認事項
以下を順番に確認・修正してください：
1. **手順1-1**: 名前付き範囲の範囲修正（「データ」→「名前付き範囲」から確認）
2. **手順1-3**: 必要なメンバー情報列が揃っているか確認
3. **手順2-1**: 必須項目（dept・email・memberId・date・memberDateId）が含まれているか確認

#### 3. メンバー情報が出揃っていないがシフト表に記入を始めたい
1. **手順2-1**: シフト表を作成するために必要な最低限の情報（dept・email）＋現時点で記載しておきたい情報を入力
2. **手順2-2〜2-3**: シフト表を作成
3. 後で情報が出揃ったら、「手順2-1」の補足にあるように、追加情報を入力
4. **手順3**: メンバー情報の更新反映を実行

#### 4. 後から特性を追加したくなった
- **シフト表作成前の場合**: 「手順1-3」を参照してメンバー情報列を追加
- **シフト表作成後の場合**: 
  1. 「2~3.メンバー情報」シートに新しい列を追加
  2. 「1~2.シフト表テンプレ」シートにも既に同じ見出しの列があることを確認（なければ手動でシフト表の全シートを修正）
  3. 「2~3.メンバー情報」シートの名前付き範囲の範囲を修正
  4. 「手順3」でメンバー情報の更新反映を実行

#### 5. 人数が増えて6分間では実行が完了しない
以下の対策を順番に試してください：
1. **分割実行**: 一度に処理する部署数を減らす（「2~3.メンバー情報」シートや「4.登録予定_入力データ」で部署を分けて複数回実行）
2. **一人あたりの日数を減らす**: 「手順2-3」で設定する日数を少なくする
3. **技術者に相談**: 処理の最適化について相談する

## 手順

### 1. シフト表テンプレート作成（初回のみ）

#### 1-1. 時間軸の設定

1. 「1~2.シフト表テンプレ」シートを開く
2. 時間軸を設定したいセル範囲を選択してください
3. メニューバー「🤖自動化ツール」→「1.シフト表テンプレ作成支援」→「時間軸を設定」をクリック
4. ポップアップダイアログに以下を入力：
   - **開始時刻**: シフトの開始時刻（例：09:00）
   - **終了時刻**: シフトの終了時刻（例：18:00）
   - **時間間隔**: 表示間隔を分単位で入力（例：30）
5. 「OK」ボタンをクリック

⚠️ **注意**: 終了時刻より右側にあるセルは更新されません。既存の時間軸の方が長い場合は、終了時刻より右側のセルを手動で削除してください。

#### 1-2. 行セットの複製

1. 複製したい行範囲を選択してください（複数行をまとめて選択可能）
2. メニューバー「🤖自動化ツール」→「1.シフト表テンプレ作成支援」→「行セットを複製」をクリック
3. 確認ダイアログで「OK」をクリック
4. ポップアップダイアログに複製回数を入力（例：10）
5. 「OK」ボタンをクリック

⚠️ **注意**: 
- 空白行も忘れずに選択してください
- 複製回数は多めに設定することをお勧めします（シフト表作成後に行を増やすと、全シートで手動調整が必要になります）

#### 1-3. メンバー情報列の準備

将来使用する可能性のあるメンバー情報列（メンバー名・所属チーム・特性等）は、この段階ですべて作成しておいてください。シフト表作成後に列を追加すると、全部署のシートで手動作業が必要になります。

### 2. シフト表の作成

#### 2-1. メンバー情報の入力

1. 「2~3.メンバー情報」シートを開く
2. 以下の必須項目を入力：
   - **dept**: 部署名（必須）
   - **email**: メールアドレス（必須）
   - その他、現時点で反映しておきたい情報

**補足**: 列の追加は後からでも可能です。現時点で情報が揃っていない場合は、情報が出揃ってから「2~3.メンバー情報」シートに追加して、手順3で反映してください。

⚠️ **注意**: ヘッダー行（1行目）は必ず設けてください。ヘッダー名を変更する場合は、「1~2.シフト表テンプレ」シートとの一致確認と名前付き範囲の修正が必要です。

#### 2-2. 空のスプレッドシートの準備

1. Google Driveで新しいスプレッドシートを作成してください
2. 作成したスプレッドシートのURLをコピーしてください

#### 2-3. シフト表の自動生成

1. このスプレッドシートに戻る
2. メニューバー「🤖自動化ツール」→「2.シフト表SS作成」→「シフト表SSに「1~2.シフト表テンプレ」をコピーして、「2~3.メンバー情報」のデータを局ごとに展開」をクリック
3. ポップアップダイアログに以下を入力：
   - **空のSSのURL**: 手順2-2でコピーしたURL
   - **一人あたりの日数**: 一人につき何日分の行を作成するか（例：4）
   - **メンバー間に空白行を挿入するなら☑**: 必要に応じてチェックを入れてください
4. 「OK」ボタンをクリック

#### 2-4. 反映結果の確認

メンバー情報シートでmemberIdにエラーが表示されていないか確認してください。エラーが表示されているメンバーの情報はシフト表に追加されていません。これはemail列またはdept列が空欄であることが原因なので、該当箇所を埋めてから再実行してください。

### 3. メンバー情報の更新反映

メンバー情報を変更した後、全シフト表に変更を反映する場合に実行してください。

**制限事項**: 以下の変更については手動対応が必要です
- **dept（部署）を変更した場合**: 該当メンバーの行を変更前の部署シートから変更後の部署シートに手動で移動してください
- **memberIdを変更した場合**: シフト表上の該当メンバーのmemberIdとmemberDateIdを手動で修正してください
- **新しいメンバーを追加した場合**: 該当部署のシフト表に行を追加して、memberIdとmemberDateIdを手動で記入してください

**実行手順**:
1. 「2~3.メンバー情報」シートでメンバー情報を更新
2. メニューバー「🤖自動化ツール」→「3.メンバー情報更新」→「「2~3.メンバー情報」のデータをシフト表SSの全シートに反映」をクリック
3. 処理完了のメッセージを確認

### 4. シフトデータの登録

実際のシフト情報をシフト表に反映する場合に実行してください。

#### 4-1. シフトデータの入力

1. 「4.登録予定_入力データ」シートを開く
2. 以下の必須項目をすべて入力：
   - **job**: シフト名（必須）
   - **startTime**: シフト開始時刻（例：09:00）（必須）
   - **endTime**: シフト終了時刻（例：17:00）（必須）
   - **dept**: 部署名（必須）
   - **memberDateId**: メンバー日付ID（必須）
   - **background**: 背景色（必須）

#### 4-2. シフトデータの反映

1. メニューバー「🤖自動化ツール」→「4.シフトデータ登録」→「「4.登録予定_入力データ」のシフトデータをシフト表SSに反映」をクリック
2. 処理完了のメッセージを確認
3. **結果データの確認と対応**:
   - **「4.登録済み_出力データ」**: 正常に反映されたすべてのシフトデータ
   - **「4.登録失敗_重複データ」**: 既存のシフトと時間が重複しているため未反映のデータ
   - **「4.登録失敗_エラーデータ」**: 必須項目の欠損などデータに不備があるため未反映のデータ
4. **次回実行の準備**: 「4.登録予定_入力データ」シートの2行目以降（データ行）を削除してください

**対処法**: 
- **重複データの場合**: 手動で反映するか、優先するシフトデータのみ入力データのシートに移して再度実行してください
- **エラーデータの場合**: 手動で反映するか、エラーメッセージを確認して入力データを修正後、再度実行してください

### 5. エラー対処法

#### よくあるエラーと対処法

**「範囲が見つかりません」エラー**
- 名前付き範囲が正しく設定されているか確認してください
- 解決しない場合はシステム管理者に相談してください

**「シートが見つかりません」エラー**
- 必要なシートが存在するか確認してください
- シート名が変更されていないか確認してください

**「データが無効です」エラー**
- 入力データの形式を確認してください
- 必須項目が空欄になっていないか確認してください
- 時刻の形式が正しいか確認してください（HH:MM形式）

#### 処理が途中で止まってしまう場合

1. スプレッドシートを一度閉じてください
2. 再度開いてから操作をやり直してください
3. それでも解決しない場合はシステム管理者に相談してください

#### サポートに連絡する際の必要情報

問題が解決しない場合は、以下の情報と共にシステム管理者に連絡してください：
- 実行したメニュー操作
- エラーメッセージの詳細（スクリーンショット）
- 操作を行った時刻
- スプレッドシートのURL
