# シフト自動化システム 利用マニュアル

## 目的

このシステムは、シフト表作成作業を効率化し、人的ミスを削減するためのツールです。以下の業務を自動化できます：

- **シフト表テンプレートの作成**: 時間軸の自動生成と行の一括複製により、効率的なシフト表のベースを作成
- **部署別シフト表の自動生成**: 「2~3.メンバー情報」シートのデータを元に、部署ごとのシフト表を自動作成
- **メンバー情報の一括更新**: 「2~3.メンバー情報」シートのデータの変更を全シフト表に一度に反映
- **シフトデータの登録・統合**: 「4.登録予定_入力データ」に入力されたシフト情報をシフト表に自動反映

## 禁止事項

### ⚠️ 絶対にやってはいけないこと

1. **原本のファイルのGASスクリプトを直接編集すること**
   - バックアップを取っていないので、スクリプトをもとに戻せなくなる可能性があります。
   - スクリプトを改良したい場合は必ずコピーを作成して、そのコピーのコンテナバインドスクリプトを編集してください。

2. **名前付き範囲の削除、名前の変更**
   - システムが正常に動作しなくなります
   - 「データ」→「名前付き範囲」で表示される名前付き範囲は削除しないでください。
   - ただし、範囲は変更してかまいません。むしろ、見出しの列数が増えたり、行方向の位置が変更されたりした場合は、必ず範囲を修正してください。名前付き範囲で過不足なく見出しの範囲や時間軸の範囲が選択できていない場合も、システムが正常に動作しなくなります。

3. **システムに組み込まれたシートの削除・名前変更**
   - 「使い方_シフト自動化」シート以外の6つのシートは削除・名前変更禁止：
     - 「1~2.シフト表テンプレ」
     - 「2~3.メンバー情報」
     - 「4.登録予定_入力データ」
     - 「4.登録済み_出力データ」
     - 「4.登録失敗_重複データ」
     - 「4.登録失敗_エラーデータ」
   - 同様に、シフト表SSで一度作成されたシートの名前を変更するのも禁止。（メンバー情報シートのdept列の値とシフト表SSのシート名が一致している必要があるため。）

4. **一部シートの見出し行の削除・変更**
   - 「2~3.メンバー情報」シートは1行目に見出し行（具体的なデータは入力せず、各列の役割を示す行。ヘッダー行）を必ず設けてください。列の追加削除、見出し名の変更は自由にしてかまいません（ただしdeptとemailは必須。列の追加削除をした場合は名前付き範囲の範囲も修正。）
   - 「4.登録予定_入力データ」シートの見出し行は、並び替えるのは構いませんが、追加削除や見出し名の変更は厳禁です。 
   - 「1~2.シフト表テンプレ」シートの見出し行は、追加削除、見出し名の変更だけでなく、位置の変更（3行目を見出し行にする、など）も自由です（ただし、memberId,date,memberDateIdは必須）。ただし、追加削除や位置の変更をした場合は、それに合わせて名前付き範囲も忘れずに修正してください。


- どうしても上記で禁止されている名前付き範囲の名前やシート名、見出し行の名前を変更したい場合は、GASをいじれる人に依頼して、スクリプトのグローバル定数を修正してもらってください。グローバル定数、と言われてピンとこないような素人には依頼しないでください。

### ⚠️ 注意すべきこと

- 処理中はシートに編集（値の追加削除、書式の変更、列の追加削除、シートの追加削除、など）を加えないでください
- エラーが発生した場合は、エラーメッセージのスクショを撮影しておいてください。さらに、エラーが続くようであればエンジニアに問い合わせてください。

## 手順

### 1. シフト表テンプレート作成（初回のみ）

#### 1-1. 時間軸の設定

1. 「1~2.シフト表テンプレ」シートを開く
2. 時間軸を設定したいセル範囲を選択
3. メニューバー「🤖自動化ツール」→「1.シフト表テンプレ作成支援」→「時間軸を設定」をクリック
4. ポップアップダイアログに以下を入力：
   - **開始時刻**: シフトの開始時刻（例：09:00）
   - **終了時刻**: シフトの終了時刻（例：18:00）
   - **時間間隔**: 表示間隔（分単位、例：30）
5. 「OK」ボタンをクリック
注意：終了時刻を入力されるセルより右側のセルは更新されません。既存の時間軸の値が新たに設定する時間軸より長い場合は、終了時刻より右側のセルは手動で削除してください。

#### 1-2. 行セットの複製

1. 複製したい行範囲を選択（複数行まとめて選択可能）
2. メニューバー「🤖自動化ツール」→「1.シフト表テンプレ作成支援」→「行セットを複製」をクリック
3. 確認ダイアログで「OK」をクリック
4. ポップアップダイアログに複製する回数を入力（例：10）
5. 「OK」ボタンをクリック
注意：
- 細い空白行を選択するのを忘れないようにしてください。
- 複製回数はなるべく多めに入力することをお勧めします。3のシフト表の作成を実行した後に列セットを増やそうとすると、それぞれのシートで手動で列の追加、列幅の調整を行う必要があります。なので、シフト表テンプレートでは一番人数の多い部署に合わせて多めに行セットを複製しておいて、3でシフト表生成後に余分な行を一括削除することをお勧めします。

#### 1-3. メンバー情報列の追加削除、変更

将来的に使用する可能性のあるメンバー情報列 （メンバーの名前や所属チーム、特性など）は、この段階ですべて作成しておいてください。メンバー情報列の追加削除、見出しの変更は、3. シフト表の作成後にやろうとすると、すべての部署のシートに対して手動で行う羽目になります。

### 2. シフト表の作成

#### 2-1. メンバー情報の入力

1. 「2~3.メンバー情報」シートを開く
2. 各列に以下の情報を入力：
   - **dept**: 部署名（必須）
   - **email**: メールアドレス（必須）
   - その他、現時点で反映しておきたい情報
「2~3.メンバー情報」シートの列の追加は 2-3.シフト表の自動生成 を実行した後でも可能です。現時点で出そろっていないメンバー情報がある場合は、情報が出そろってから、「2~3.メンバー情報」シートに追加して、反映してください。詳しくは3.メンバー情報の更新反映を参照。

⚠️ **注意**: 禁止事項の4でも述べたように、ヘッダー行（1行目）を必ず設けてください。ヘッダー名の更新は自由ですが、「1~2.シフト表テンプレ」シートに一致するヘッダー名がない場合転記されない点、名前付き範囲の範囲を修正する必要がある点、に注意してください。

#### 2-2. 空のスプレッドシートの準備

1. Google Driveで新しいスプレッドシートを作成
2. そのスプレッドシートのURLをコピー

#### 2-3. シフト表の自動生成

1. このスプレッドシートに戻る
2. メニューバー「🤖自動化ツール」→「2.シフト表SS作成」→「シフト表SSに「1~2.シフト表テンプレ」をコピーして、「2~3.メンバー情報」のデータを局ごとに展開」をクリック
3. ポップアップダイアログに必要事項3つを入力：
   - **空のSSのURL**: 手順2-2でコピーしたURL
   - **一人あたりの日数**: 一人につき何日分の行を作成するか（例：4）
   - **メンバー間に空白行を挿入するなら☑**: 必要に応じてチェック
4. 「OK」ボタンをクリック

#### 2-4. メンバー情報がシフト表に反映されたか確認
メンバー情報シートで、memberIdにエラーがないか確認。エラーが表示されているメンバーの情報はシフト表に追加されていない。これはemail列またはdept列が空欄であることが原因なので、email列、dept列の値を埋めてから再実行。

### 3. メンバー情報の更新反映

メンバー情報を変更した後、全シフト表に変更を反映する場合に実行：
注意：memberId,deptの変更と、新しいメンバーの追加には対応していない。それぞれ以下の対応をとる。
- deptを変更した場合：手動でシフト表上のdeptを変更したメンバーの行を変更前のdeptのシートから変更後のdeptのシートに移動。
- memberIdを変更した場合：手動でシフト表上のmemberIdを変更したメンバーのmemberIdとmemberDateIdを修正。
- 新しいメンバーを追加した場合：そのメンバー用の行をシフト表に追加して、memberIdとmemberDateIdを手動で記入。
メンバー情報シートのdept列の値と、シフト表の
1. 「2~3.メンバー情報」シートでメンバー情報を更新
2. メニューバー「🤖自動化ツール」→「3.メンバー情報更新」→「「2~3.メンバー情報」のデータをシフト表SSの全シートに反映」をクリック
3. 処理完了のメッセージを確認

### 4. シフトデータの登録

実際のシフト情報をシフト表に反映する場合：

#### 5-1. シフトデータの入力

1. 「4.登録予定_入力データ」シートを開く
2. 各列に以下の情報を入力：
   - **memberDateId**: メンバー日付ID（必須）
   - **startTime**: 開始時刻（例：09:00）
   - **endTime**: 終了時刻（例：17:00）
   - **dept**: 部署名（必須）
   - その他必要な情報

#### 5-2. シフトデータの反映

1. メニューバー「🤖自動化ツール」→「4.シフトデータ登録」→「「4.登録予定_入力データ」のシフトデータをシフト表SSに反映」をクリック
2. 処理完了のメッセージを確認

### 6. エラー対処法

#### よくあるエラーと対処法

**「範囲が見つかりません」エラー**
- 名前付き範囲が正しく設定されているか確認
- システム管理者に相談

**「シートが見つかりません」エラー**
- 必要なシートが存在するか確認
- シート名が変更されていないか確認

**「データが無効です」エラー**
- 入力データの形式を確認
- 必須項目が空欄になっていないか確認
- 時刻の形式が正しいか確認（HH:MM形式）

**処理が途中で止まる場合**
1. スプレッドシートを一度閉じる
2. 再度開いてから操作をやり直す
3. それでも解決しない場合はシステム管理者に相談

#### サポート

問題が解決しない場合は、以下の情報と共にシステム管理者に連絡してください：
- 実行したメニュー操作
- エラーメッセージの詳細
- 操作を行った時刻
- スプレッドシートのURL
